@page
@model WebClinic.Pages.Patient.IndexModel

@{
    var date = Model.ViewModel.BirthDate;
    var age = DateTime.Now.Year - date.Year;
    if (DateTime.Now.DayOfYear < date.DayOfYear)
    {
        age--;
    }
}

<div style="display: flex; flex-direction: row; align-items: flex-start">
    <div class="flex-column flex-shrink-0 p-3 bg-light" style="width: 280px; display: inline-block">
        <span class="fs-4">Пациент</span>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
                <a asp-page="Index" class="nav-link active" aria-current="page">
                    <svg class="bi pe-none me-2" width="16" height="16">
                        <use xlink:href="#home"></use>
                    </svg>Медицинская карта
                </a>
            </li>
            <li>
                <a asp-page="ActiveRecords" class="nav-link link-dark">
                    <svg class="bi pe-none me-2" width="16" height="16">
                        <use xlink:href="#speedometer2"></use>
                    </svg>Заказы
                </a>
            </li>
            <li>
                <a asp-page="Settings" class="nav-link link-dark">
                    <svg class="bi pe-none me-2" width="16" height="16">
                        <use xlink:href="#table"></use>
                    </svg>Настройки
                </a>
            </li>
        </ul>
        <hr>
    </div>
    <div class="flex-column flex-shrink-0 p-3 bg-light" style="display: inline-block; margin-left: 10px">
        <p>@Model.ViewModel.Surname @Model.ViewModel.Name @Model.ViewModel.Patronymic</p>
        <p>Дата рождения: @date.ToLongDateString() (@age лет)</p>
        <p>Пол: @Model.ViewModel.Gender</p>
        <p>Номер телефона: @Model.ViewModel.Phone</p>

    </div>
</div>
<div>
    @if (Model.ViewModel.ArchivedRecords.Count == 0)
    {
        <p>Записей нет</p>
    }
    else
    {
        foreach (var record in Model.ViewModel.ArchivedRecords)
        {
            <p>Лечащий врач @record.FkEmployeeNavigation?.Surname @record.FkEmployeeNavigation?.Name @record.FkEmployeeNavigation?.Patronymic</p>
            <p>@record.FkPatientNavigation?.Gender</p>
            <p>Номера телефонов: @record.FkEmployeeNavigation?.FkUsersNavigation?.PhoneNumber</p>
            @if (record.DateRecord is null)
            {
                <p>Время не назначено</p>
            }
            else
            {
                <p>Время посещения @record.DateRecord.Value</p>
            }
            <p>Диагноз: @record.Diagnosis</p>
            <p>Лечение:</p>
            <p>@record.Therapy</p>
        }
    }
</div>

